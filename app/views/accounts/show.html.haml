%script
  $(function(){
  $('#daterangepicker').daterangepicker({arrows:false, onchange:true}); 
  });
%header
  .right 
    = render :partial => 'shared/links'
    - if @account.can_send_weekly_report_now?
      = link_to "| Send Email ", send_weekly_path(params[:id])
    = link_to "| Export Client PDF", report_client_pdf_path(params[:id])
  
  %h2= @account.name
  #datepicker=render :partial => "shared/date_picker"
%article
  
  %table
    %thead
      %tr
        %th Campaign Name (Click for Details)
        %th Lead Calls
        %th All Calls
        %th Lead Forms
        %th All Forms
        %th Total Leads
        %th Total Contacts
        %th Cost
        %th Spend (Marked-Up)
        %th Cost Per Lead
        %th Cost Per Contact
    %tbody
      %tr
        %td.large.strong Managed
      - @managed_total_results = Campaign.determine_totals_for(@managed_campaigns, @total_reporting_messages, @start_date, @end_date)      
      - @managed_campaigns.each do |campaign|
        %tr
          %td= link_to campaign.name, campaign_path(campaign, :daterange => params[:daterange])
          %td= campaign.number_of_lead_calls_between(@start_date, @end_date).to_s
          %td= campaign.number_of_all_calls_between(@start_date, @end_date).to_s
          %td= campaign.number_of_lead_submissions_between(@start_date, @end_date).to_s
          %td= campaign.number_of_all_submissions_between(@start_date, @end_date).to_s
          %td= campaign.number_of_total_leads_between(@start_date, @end_date).to_s
          %td= campaign.number_of_total_contacts_between(@start_date, @end_date).to_s
          %td= ActionController::Base.helpers.number_to_currency(campaign.cost_between(@start_date, @end_date))
          %td= ActionController::Base.helpers.number_to_currency(campaign.spend_between(@start_date, @end_date))
          %td= ActionController::Base.helpers.number_to_currency(campaign.cost_per_lead_between(@start_date, @end_date))
          %td= ActionController::Base.helpers.number_to_currency(campaign.cost_per_contact_between(@start_date, @end_date))
      %tr.strong
        %td Total Managed:
        %td= @managed_total_results[@total_reporting_messages[0]].to_s
        %td= @managed_total_results[@total_reporting_messages[1]].to_s
        %td= @managed_total_results[@total_reporting_messages[2]].to_s
        %td= @managed_total_results[@total_reporting_messages[3]].to_s
        %td= @managed_total_results[@total_reporting_messages[4]].to_s
        %td= @managed_total_results[@total_reporting_messages[5]].to_s
        %td= ActionController::Base.helpers.number_to_currency(@managed_total_results[@total_reporting_messages[6]])
        %td= ActionController::Base.helpers.number_to_currency(@managed_total_results[@total_reporting_messages[7]])
        %td= ActionController::Base.helpers.number_to_currency(Campaign.weighted_cost_per_lead_for(@managed_campaigns, @start_date, @end_date))
        %td= ActionController::Base.helpers.number_to_currency(Campaign.weighted_cost_per_contact_for(@managed_campaigns, @start_date, @end_date))
      
      %tr
        %td.large.unmanaged Un-managed
      - @unmanaged_total_results = Campaign.determine_totals_for(@unmanaged_campaigns, @total_reporting_messages, @start_date, @end_date) 
      - @unmanaged_campaigns.each do |campaign|
        %tr.unmanaged
          %td{:class => "unmanaged"}= link_to campaign.name, campaign_path(campaign, :daterange => params[:daterange])
          %td= campaign.number_of_lead_calls_between(@start_date, @end_date).to_s
          %td= campaign.number_of_all_calls_between(@start_date, @end_date).to_s
          %td= campaign.number_of_lead_submissions_between(@start_date, @end_date).to_s
          %td= campaign.number_of_all_submissions_between(@start_date, @end_date).to_s
          %td= campaign.number_of_total_leads_between(@start_date, @end_date).to_s
          %td= campaign.number_of_total_contacts_between(@start_date, @end_date).to_s
          %td= ActionController::Base.helpers.number_to_currency(campaign.cost_between(@start_date, @end_date))
          %td= ActionController::Base.helpers.number_to_currency(campaign.spend_between(@start_date, @end_date))
          %td= ActionController::Base.helpers.number_to_currency(campaign.cost_per_lead_between(@start_date, @end_date))
          %td= ActionController::Base.helpers.number_to_currency(campaign.cost_per_contact_between(@start_date, @end_date))
      %tr.unmanaged.strong
        %td Total Unmanaged
        %td= @unmanaged_total_results[@total_reporting_messages[0]].to_s
        %td= @unmanaged_total_results[@total_reporting_messages[1]].to_s
        %td= @unmanaged_total_results[@total_reporting_messages[2]].to_s
        %td= @unmanaged_total_results[@total_reporting_messages[3]].to_s
        %td= @unmanaged_total_results[@total_reporting_messages[4]].to_s
        %td= @unmanaged_total_results[@total_reporting_messages[5]].to_s
        %td= ActionController::Base.helpers.number_to_currency(@unmanaged_total_results[@total_reporting_messages[6]])
        %td= ActionController::Base.helpers.number_to_currency(@unmanaged_total_results[@total_reporting_messages[7]])
        %td= ActionController::Base.helpers.number_to_currency(Campaign.weighted_cost_per_lead_for(@unmanaged_campaigns, @start_date, @end_date))
        %td= ActionController::Base.helpers.number_to_currency(Campaign.weighted_cost_per_contact_for(@unmanaged_campaigns, @start_date, @end_date))