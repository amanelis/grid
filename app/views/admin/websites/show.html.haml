%h1
  #{@website.nickname} Visits
%h3
  Website Statistics
%article
  %table{:class => "pretty"}
    %thead
      %th Website
      %th Visits
      %th Actions
      %th Avg Actions/Visit
      %th Total Time Spent
      %th Avg Time Spent
      %th Bounce Rate
    %tbody
      %tr{:class => cycle('odd', 'even')}
        %td= @website.nickname%td= @website.visits_between(Date.today - 1.week, Date.today).to_s
        %td= @website.actions_between(Date.today - 1.week, Date.today).to_s
        %td= '%.2f' % @website.average_actions_between(Date.today - 1.week, Date.today).to_s
        %td
          - @total_time = @website.total_time_spent_between(Date.today - 1.week, Date.today)
          = [(@total_time/3600).to_s + 'h', (@total_time/60 % 60).to_s + 'm', (@total_time % 60).to_s + 's'].map{|t| t.to_s.rjust(2,'0')}.join(':')
        %td
          - @avg_time = @website.average_total_time_spent_between(Date.today - 1.week, Date.today).to_i
          = [(@avg_time/3600).to_s + 'h', (@avg_time/60 % 60).to_s + 'm', (@avg_time % 60).to_s + 's'].map{|t| t.to_s.rjust(2,'0')}.join(':')
        %td= (sprintf("%.2f", (@website.bounce_rate_between(Date.today - 1.week, Date.today) * 100)) + '%')

%h3
  Website Visits....from Forever Ago
%article
  %table{:class => "pretty"}
    %thead
      %th Visitor ID
      %th Time Of Visit
      %th IP Address
      %th Location
      %th Actions
      %th Source
      %th Referrer
      %th Keyword
      %th Time Spent
    %tbody
      - (@website.website_visits.sort { |a,b| b.time_of_visit <=> a.time_of_visit }).each do |website_visit|
        %tr{:class => cycle('odd', 'even')}
          %td=website_visit.visitor_id
          %td=website_visit.time_of_visit.to_s(:long)
          %td=website_visit.ip_address
          %td=website_visit.geolocation
          %td=website_visit.actions
          %td=website_visit.referrer_type
          %td=website_visit.referrer_domain
          %td=website_visit.referrer_search
          %td=website_visit.time_total
          

