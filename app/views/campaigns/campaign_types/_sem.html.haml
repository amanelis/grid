%article
  %h3 Conversion Details
  %table
    %thead
      %tr
        %th Lead Calls
        %th All Calls
        %th Lead Forms
        %th All Forms
        %th Total Leads
        %th Total Contacts
        %th Spend
        %th Cost Per Lead
        %th Cost Per Contact
    %tbody
      %tr
        %td= @campaign.number_of_lead_calls_between(@start_date, @end_date).to_s
        %td= @campaign.number_of_all_calls_between(@start_date, @end_date).to_s
        %td= @campaign.number_of_lead_submissions_between(@start_date, @end_date).to_s
        %td= @campaign.number_of_all_submissions_between(@start_date, @end_date).to_s
        %td= @campaign.number_of_total_leads_between(@start_date, @end_date).to_s
        %td= @campaign.number_of_total_contacts_between(@start_date, @end_date).to_s
        %td= ActionController::Base.helpers.number_to_currency(@campaign.spend_between(@start_date, @end_date))
        %td= ActionController::Base.helpers.number_to_currency(@campaign.cost_per_lead_between(@start_date, @end_date))
        %td= ActionController::Base.helpers.number_to_currency(@campaign.cost_per_contact_between(@start_date, @end_date))
  %h3 Adwords Campaigns(In progress)
  %table
    %thead
      %tr
        %th Adwords Campaign Name
        %th Clicks
        %th Impressions
        %th CTR
        %th Avg. CPC
        %th Cost
        %th Avg. Position
        %th Quality Score
    %tbody
      %tr
        %td Glasses
        %td 78
        %td 210
        %td 38%
        %td $40.50
        %td $2,000.00
        %td 1.2
        %td 2/10
  - if can? :update, @campaign
    %h3 Phone Numbers On Campaign
    %table
      %thead
        %tr
          %th Name
          %th Description
          %th Number
      %tbody
        -@campaign.phone_numbers.each do |number|
          %tr
            %td= number.name
            %td= number.descript
            %td= number.inboundno
  %h3 Form Submissions
  %table
    %thead
      %tr
        %th Name
        %th Email
        %th Phone Number
        %th Submission Time
        %th Date Requested
        %th Time Requested
        %th Work Description
    %tbody
      -@campaign.submissions.lead.between(@start_date, @end_date).each do |submission|
        %tr
          %th Name
          %th Email
          %th Phone Number
          %th Submission Time
          %th Date Requested
          %th Time Requested
          %th Work Description
      %tbody
        -@submissions.each do |submission|
          %tr
            %td= submission.name
            %td= submission.from_email
            %td= submission.phone_number
            %td= submission.time_of_submission.in_time_zone.to_s(:short)
            %td= submission.date_requested
            %td= submission.time_requested
            %td= submission.work_description
  
  -if can? :create, ContactForm
    = link_to '+ Create Form', new_campaign_contact_form_path(@campaign), :class => "submit button", :name => "submit"
  
  %h3 Call Log
  %table
    %thead
      %tr
        %th Caller
        %th Caller #
        %th Inbound #
        %th Time of Call
        %th Duration
        %th Result
        %th Recording
        %th Review
    %tbody
      -@calls = @campaign.calls.between(@start_date, @end_date).paginate(:page => (params[:page] || 1), :order => 'name DESC', :per_page => 10).each do |call|
        %tr
          %td= call.caller_name
          %td= number_to_phone(call.caller_number)
          %td= number_to_phone(call.inboundno)
          %td= call.call_start.in_time_zone.to_s(:short)
          %td= call.duration
          %td= call.call_status
          %td.recording
            -if call.recorded? && call.recording?
              = link_to('Listen', call.recording.expiring_url(14400))
              = mp3_player "#{call.recording.expiring_url(14400)}", :bg => "EEEEEE", :track => "EEEEEE", :slider => "222222", :loader => "EEEEEE"
            -else
              = "Call Recording Unavailable"
          %td
            - form_for (call.activity) do |f|
              = f.select(:review_status, (call.review_status_options))
              = f.hidden_field(:campaign_id, {:value => params[:id]})
  .right.pagination= will_paginate(@calls)